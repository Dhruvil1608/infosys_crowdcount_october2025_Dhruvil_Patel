<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CrowdCount Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="dashboard.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-header">ğŸ¯ CrowdCount</div>
      <ul>
        <li class="active" onclick="showSection('home')">
          <i class="fas fa-home"></i> Home
        </li>
        <li onclick="showSection('image')">
          <i class="fas fa-image"></i> Image Analysis
        </li>
        <li onclick="showSection('video')">
          <i class="fas fa-film"></i> Video Analysis
        </li>
        <li onclick="showSection('webcam')">
          <i class="fas fa-video"></i> Webcam Analysis
        </li>
        <li onclick="showSection('analytics')">
          <i class="fas fa-chart-bar"></i> Analytics
        </li>
        <li onclick="showSection('settings')">
          <i class="fas fa-cog"></i> Settings
        </li>
        <li onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </li>
      </ul>
    </aside>

    <main class="main">
      <header class="dashboard-header">
        <h1>Hello <span id="username">User</span></h1>
        <p class="subtitle">Real-time crowd monitoring and analytics</p>
      </header>

      <!-- Home Section -->
      <div id="homeSection" class="content-section">
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-title">ğŸ‘¥ Total People Today</div>
            <div class="stat-value" id="totalCount">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ğŸ”„ Active Sessions</div>
            <div class="stat-value" id="activeSessions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">ğŸ“Š Total Detections</div>
            <div class="stat-value" id="detectionRate">0</div>
          </div>
        </div>

        <div class="chart-section">
          <h2 class="section-title">ğŸ“ˆ Detection Trends by Type</h2>
          <p style="color: #ccc; margin-bottom: 15px;">
            People count across webcam, video, and image analysis sessions
          </p>
          <div class="chart-container" id="homeLineChartContainer">
            <p style="color: #ccc; text-align: center; padding: 50px 0;">
              Loading detection trends...
            </p>
          </div>
        </div>

        <div class="chart-section">
          <h2 class="section-title">ğŸ“Š Daily Detection Summary</h2>
          <p style="color: #ccc; margin-bottom: 15px;">
            Total people detected each day (Last 7 days)
          </p>
          <div class="chart-container" id="homeDailyChartContainer">
            <p style="color: #ccc; text-align: center; padding: 50px 0;">
              Loading daily summary...
            </p>
          </div>
        </div>

        <div class="video-section">
          <h2 class="section-title">ğŸ¬ Quick Start</h2>
          <p style="color: #ccc; margin-bottom: 20px;">
            Start analyzing people with our advanced detection system
          </p>
          <div class="video-controls">
            <button class="btn" onclick="showSection('image')">
              <i class="fas fa-image"></i> Analyze Image
            </button>
            <button class="btn btn-success" onclick="showSection('webcam')">
              <i class="fas fa-video"></i> Start Webcam Analysis
            </button>
            <button class="btn" onclick="showSection('video')">
              <i class="fas fa-film"></i> Upload Video
            </button>
            <button class="btn" onclick="showSection('analytics')">
              <i class="fas fa-chart-bar"></i> View Analytics
            </button>
          </div>
        </div>

        <div class="video-section">
          <h2 class="section-title">ğŸ“Š Recent Activity</h2>
          <div id="recentActivity" style="color: #ccc;">
            Loading recent detections...
          </div>
        </div>
      </div>

      <!-- Image Analysis Section -->
      <div id="imageSection" class="content-section" style="display:none;">
        <div class="video-section">
          <h2 class="section-title">ğŸ–¼ï¸ Image Analysis</h2>
          <p style="color: #ccc; margin-bottom: 20px;">Upload an image to detect and count people with zone detection</p>
          
          <div class="video-controls">
            <label for="imageUpload" class="upload-label">
              <i class="fas fa-upload"></i> Upload Image
            </label>
            <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
            <span class="file-name" id="imageFileName"></span>
            <button class="btn btn-success" onclick="analyzeImage()" id="analyzeImageBtn" disabled>
              <i class="fas fa-search"></i> Analyze
            </button>
            <button class="btn btn-warning" onclick="drawImageZone()" id="drawImageZoneBtn" disabled>
              <i class="fas fa-draw-polygon"></i> Draw Zone
            </button>
            <button class="btn" onclick="toggleHeatmap()" id="heatmapToggle">
              <i class="fas fa-fire"></i> Heatmap: OFF
            </button>
            <button class="btn" onclick="saveImageSession()" id="saveImageBtn" disabled>
              <i class="fas fa-save"></i> Save Results
            </button>
            <button class="btn btn-danger" onclick="resetImageAnalysis()">
              <i class="fas fa-redo"></i> Reset
            </button>
          </div>

          <div id="imageDrawingInstructions" class="drawing-instructions" style="display:none;">
            <strong>ğŸ¯ Drawing Zone:</strong> Click on the image to create polygon points. Click the first point again to close the zone, or press 'Escape' to cancel.
          </div>

          <div class="video-container" id="imageContainer">
            <canvas id="imageCanvas" style="display:none;"></canvas>
            <span class="placeholder" id="imagePlaceholder">Upload an image to begin</span>
          </div>

          <div class="results-panel">
            <div class="result-item">
              <div class="result-label">ğŸ‘¥ People Detected</div>
              <div class="result-value" id="imagePeopleCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">ğŸ¯ Zones Defined</div>
              <div class="result-value" id="imageZoneCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">ğŸ“Š Status</div>
              <div class="result-value" id="imageStatus" style="font-size: 1.2em;">Ready</div>
            </div>
          </div>

          <div id="imageZoneList" class="zone-list" style="display:none;">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">Zone Counts:</h3>
            <div id="imageZones"></div>
          </div>

          <div id="imageHeatmapDisplay" class="heatmap-display">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">ğŸ”¥ Heatmap Visualization:</h3>
          </div>
        </div>
      </div>

      <!-- Video Analysis Section -->
      <div id="videoSection" class="content-section" style="display:none;">
        <div class="video-section">
          <h2 class="section-title">ğŸ¬ Video Analysis</h2>
          <p style="color: #ccc; margin-bottom: 20px;">Upload a video to analyze people count and track line crossings</p>
          
          <div class="video-controls">
            <label for="videoUpload" class="upload-label">
              <i class="fas fa-upload"></i> Upload Video
            </label>
            <input type="file" id="videoUpload" accept="video/*" onchange="handleVideoUpload(event)">
            <span class="file-name" id="fileName"></span>
            <button class="btn btn-success" onclick="startVideoAnalysis()" id="analyzeBtn" disabled>
              <i class="fas fa-play"></i> Start Analysis
            </button>
            <button class="btn btn-danger" onclick="pauseVideoAnalysis()" id="pauseBtn" disabled>
              <i class="fas fa-pause"></i> Pause
            </button>
            <button class="btn btn-warning" onclick="drawVideoLine()" id="drawLineBtn" disabled>
              <i class="fas fa-minus"></i> Draw Line
            </button>
            <button class="btn btn-warning" onclick="drawVideoZone()" id="drawVideoZoneBtn" disabled>
              <i class="fas fa-draw-polygon"></i> Draw Zone
            </button>
            <button class="btn" onclick="saveVideoSession()" id="saveVideoBtn" disabled>
              <i class="fas fa-save"></i> Save Results
            </button>
            <button class="btn btn-danger" onclick="resetVideoAnalysis()">
              <i class="fas fa-redo"></i> Reset
            </button>
          </div>

          <div id="videoDrawingInstructions" class="drawing-instructions" style="display:none;">
            <strong id="videoDrawingMode">ğŸ¯ Drawing Mode:</strong>
          </div>

          <div class="video-container" id="videoContainer">
            <canvas id="videoCanvas" style="display:none;"></canvas>
            <span class="placeholder" id="videoPlaceholder">Upload a video to begin</span>
          </div>

          <div class="results-panel">
            <div class="result-item">
              <div class="result-label">ğŸ‘¥ Max People</div>
              <div class="result-value" id="videoPeopleCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">â¡ï¸ Line Crossings</div>
              <div class="result-value" id="lineCrossings">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">ğŸ¯ Zones</div>
              <div class="result-value" id="videoZoneCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">â±ï¸ Duration</div>
              <div class="result-value" id="analysisDuration">0s</div>
            </div>
          </div>

          <div id="videoZoneList" class="zone-list" style="display:none;">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">Zone Counts:</h3>
            <div id="videoZones"></div>
          </div>
        </div>
      </div>

      <!-- Webcam Analysis Section -->
      <div id="webcamSection" class="content-section" style="display:none;">
        <div class="video-section">
          <h2 class="section-title">ğŸ“¹ Webcam Analysis</h2>
          <p style="color: #ccc; margin-bottom: 20px;">Real-time people detection from your webcam</p>
          
          <div class="video-controls">
            <button class="btn btn-success" onclick="startWebcam()" id="startWebcamBtn">
              <i class="fas fa-video"></i> Start Webcam
            </button>
            <button class="btn btn-danger" onclick="stopWebcam()" id="stopWebcamBtn" disabled>
              <i class="fas fa-stop"></i> Stop Webcam
            </button>
            <button class="btn btn-warning" onclick="drawWebcamLine()" id="drawWebcamLineBtn" disabled>
              <i class="fas fa-minus"></i> Draw Line
            </button>
            <button class="btn btn-warning" onclick="drawWebcamZone()" id="drawWebcamZoneBtn" disabled>
              <i class="fas fa-draw-polygon"></i> Draw Zone
            </button>
            <button class="btn" onclick="toggleHeatmap()" id="webcamHeatmapToggle">
              <i class="fas fa-fire"></i> Heatmap: OFF
            </button>
            <button class="btn" onclick="saveWebcamSession()" id="saveWebcamBtn" disabled>
              <i class="fas fa-save"></i> Save Results
            </button>
            <button class="btn btn-danger" onclick="resetWebcamCrossings()">
              <i class="fas fa-redo"></i> Reset Crossings
            </button>
          </div>

          <div id="webcamDrawingInstructions" class="drawing-instructions" style="display:none;">
            <strong id="webcamDrawingMode">ğŸ¯ Drawing Mode:</strong>
          </div>

          <div class="video-container" id="webcamContainer">
            <canvas id="webcamCanvas" style="display:none;"></canvas>
            <span class="placeholder" id="webcamPlaceholder">Click "Start Webcam" to begin</span>
          </div>

          <div class="results-panel">
            <div class="result-item">
              <div class="result-label">ğŸ‘¥ Current People</div>
              <div class="result-value" id="webcamPeopleCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">ğŸ“ˆ Max People</div>
              <div class="result-value" id="webcamMaxCount">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">â¡ï¸ Crossings</div>
              <div class="result-value" id="webcamCrossings">0</div>
            </div>
            <div class="result-item">
              <div class="result-label">ğŸ¯ Zones</div>
              <div class="result-value" id="webcamZoneCount">0</div>
            </div>
          </div>

          <div id="webcamZoneList" class="zone-list" style="display:none;">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">Zone Counts:</h3>
            <div id="webcamZones"></div>
          </div>

          <div class="live-chart-container" style="display:none;" id="liveChartDisplay">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">ğŸ“Š Live People Count</h3>
          </div>

          <div class="live-chart-container" style="display:none;" id="zoneChartDisplay">
            <h3 style="color: #8e2de2; margin-bottom: 10px;">ğŸ¯ Zone Distribution</h3>
          </div>
        </div>
      </div>

      <!-- Analytics Section -->
      <div id="analyticsSection" class="content-section" style="display:none;">
        <div class="analytics-section">
          <h2 class="section-title">ğŸ“Š Analytics Dashboard</h2>
          <p style="color: #ccc; margin-bottom: 20px;">View your detection history and statistics</p>

          <div class="filter-tabs">
            <div class="filter-tab active" onclick="loadAnalytics('all')">All</div>
            <div class="filter-tab" onclick="loadAnalytics('today')">Today</div>
            <div class="filter-tab" onclick="loadAnalytics('week')">This Week</div>
            <div class="filter-tab" onclick="loadAnalytics('month')">This Month</div>
          </div>

          <table class="analytics-table">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Type</th>
                <th>People Count</th>
                <th>Zones</th>
              </tr>
            </thead>
            <tbody id="analyticsTableBody">
              <tr>
                <td colspan="4" style="text-align: center; padding: 40px; color: #ccc;">
                  Loading analytics data...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Settings Section -->
      <div id="settingsSection" class="content-section" style="display:none;">
        <div class="analytics-section">
          <h2 class="section-title">âš™ï¸ Settings</h2>
          <p style="color: #ccc; margin-bottom: 20px;">Configure your application preferences</p>

          <div class="settings-card">
            <h3>User Information</h3>
            <div class="setting-item">
              <span class="setting-label">Username</span>
              <span class="setting-value" id="settingsUsername">-</span>
            </div>
            <div class="setting-item">
              <span class="setting-label">Email</span>
              <span class="setting-value" id="settingsEmail">-</span>
            </div>
          </div>

          <div class="settings-card">
            <h3>Detection Settings</h3>
            <div class="setting-item">
              <span class="setting-label">Enable Heatmap</span>
              <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="enableHeatmapSetting" onchange="updateHeatmapSetting(this.checked)">
                <span>Show heatmap overlay</span>
              </label>
            </div>
            <div class="setting-item">
              <span class="setting-label">Enable Alerts</span>
              <label style="display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="enableAlertsSetting" checked onchange="updateAlertsSetting(this.checked)">
                <span>Play sound alerts</span>
              </label>
            </div>
          </div>

          <div class="settings-card">
            <h3>Zone Thresholds</h3>
            <div id="thresholdsList" style="color: #ccc;">
              No zone thresholds set yet. Create zones in analysis mode to set thresholds.
            </div>
          </div>

          <div class="settings-card">
            <h3>Account Actions</h3>
            <button class="btn btn-danger" onclick="logout()" style="width: auto;">
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="alertContainer"></div>

  <script src="dashboard-script.js"></script>
</body>
</html>